<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, maximum-scale=1.0" />

    <title>Example Student's HCDE 439 Physical Computing Page!</title>

    <link href="style.css" rel="stylesheet" type="text/css" />
  </head>
  <body>
    <h1>Assignment 5: Higher Voltage and Transistors!</h1>
    <div class="assignment">
      <div>
        <img src="a5highervoltage.jpg" />
        <p>Here is the picture of my circuit.</p>
      </div>
      <div>
        <img src="a5.gif" />
        <p>Here is the gif of my circuit when I place my hand in front of the ultrasonic sensor</p>
      </div>
      <div>
        <img src="a5schematic.jpg" />
        <p>Here is the picture of my schematic.</p>
      </div>
    </div>

    <h2>Firmware-Code from Arduino IDE</h2>
    <pre><code>
    //This code is to control the ouptut of a higher voltage device (LED Strip) using an ultrasonic motor
    //Used references from: https://projecthub.arduino.cc/Isaac100/getting-started-with-the-hc-sr04-ultrasonic-sensor-7cabe1


    #define led_pin 9 // defining the the MOSFET gate pin
    #define trig_pin 6   // defining the 6 pin for the ultrasonic trigger
    #define echo_pin 7   // defining the 7 pin from the ultrasonic echo

    void setup() {
    Serial.begin(9600);  //intializing to set up the serial monitor using the baud value on screen
    pinMode(trig_pin, OUTPUT); //setting the trigger pin as an output
    pinMode(echo_pin, INPUT); //setting the echo pin as an input
    pinMode(led_pin, OUTPUT); //setting the led pin as an output

    analogWrite(led_pin, 0);  // the LED strip starting as off
    }

    void loop() {
    //Trigger the ultrasonic sensor
    digitalWrite(trig_pin, LOW);   //Starting with low
    delayMicroseconds(2); //waiting 2 microseconds
    digitalWrite(trig_pin, HIGH);  // pulsing the trigger pin
    delayMicroseconds(10); //waiting 10 microseconds
    digitalWrite(trig_pin, LOW); //turning it back to low


    long duration = pulseIn(echo_pin, HIGH, 30000); //reading and cutoff echo after 30000 microseconds
    float distance_cm = duration * 0.034 / 2.0; //using the speed = distance/time equation and using speed of sounds in centimeters per micorsecond as 0.034 cm/Âµs

    distance_cm = constrain(distance_cm, 5, 150); // Making sure the range is contrained between 5 and 250 cm
    int brightness = map((int)distance_cm, 5, 150, 255, 0);  //Mapping this input distance to LED brightness

    analogWrite(led_pin, brightness); //writing this value to the pwn pin to control LED brightness

    //Sendng the values to the serial printer for the distance and brightness
    Serial.print("Distance (cm): ");
    Serial.print(distance_cm);
    Serial.print("   Brightness: ");
    Serial.println(brightness);

    delay(100);  //waiting betweem readings
    }
    </code></pre>

     <div class="assignment">
      <h2>Additional Questions</h2>

      <h3>Question 1</h3>
      <p>The high time in every pulse cycle will increase as the angle increases each time. It will still reach 5V.
        <img src="a4q1.jpg"/></p>

      <h3>Question 2</h3>
      <p> 
        Since we do the readings multiple times for the capacitive sensor, the values are averaged to give a smoother reading. But, if there was
        an erratic reading, it's impact wouln't be that larger as it would be averaged out. But to be extra safe, we could filter out any readings that
        are way out of range, and contrain the readings. 
        Example pseudo code:
        Get the reading from the sensor
        If the reading is outside of the range that we expect (like greater than 2000)
          use the previous reading
        Else
          Use the reading
        If the reading is very different from the previous reading (like greater than 500)
          use the previous reading instead
        Else
          Use the reading
        remember it for the next reading
        </p>

      <h3>Question 3</h3>
      <p>We already take 30 tests inside one function that smoothes it up. But 
        since the +/- 10% noise is happening reading to reading, we can then do another average.
        Here is how the psuedo code would look like:
        initialize the total varabile to 0
        get one reading using capactiveSensor(30)
        add this reading to the total
        divide the total by the number of readings taken
        use this final average reading for the mapping to servo angle
      </p>

    </div>
  </body>
</html>
